# Base on offical Node.js Alpine image
FROM node:19-alpine
WORKDIR /app
RUN npm install --global --force yarn pm2
COPY ./package*.json ./
RUN yarn config set ignore-engines true \
    && yarn install --production --ignore-scripts --ignored-prepublish=react,recompose --ignore-platform --ignore-engines --silent --no-progress --no-optional
COPY ./ ./
RUN yarn run build
EXPOSE 3001
USER root
CMD [ "pm2-runtime", "yarn", "--", "start" ]